# 用户行为及如何收集用户行为数据



**深入研究数据收集：**

- 构建一个收集器来收集这些事件；
- 将收集器集成到应用中并获取在站点上表示出来的类似事件；
- 有了全面的总体认知及实现后，再回头分析一般性的用户行为；

证据(Evidence)是揭示用户偏好的数据。当我们谈论证据时，我们是在收集表征某用户喜好的事件和行为。

遗憾的是：适用于某个系统的数据可能不使用于另一个系统。要想收集到正确的证据，就需要投入精力和进行思考。

一个系统的用户通常会产生两种类型的反馈：显式的(explicit，点赞或评分)和隐式的(implicit，通过监视用户而记录的活动)。

### 1、在浏览网站时Netflix如何收集证据

对于流媒体网站，如果一位访客开始看一部电影，这是一个积极的事件，但如果他在三分钟后停下来并且没有重新开始看，那么这表明他不喜欢所看到的内容。如果他稍后或在某个时间段内重新开始看这部电影，这可能意味着他们比第一次看的时候更喜欢它。

当Jimmy看电影时，想象一下Netflix服务器上发生了什么？

<center>表1、Netflix的证据示例</center>
| 事件                           | 含义                                               |  事件名称   |
| :----------------------------- | -------------------------------------------------- | :---------: |
| 滚动主题行                     | 用户对该主题感兴趣                                 |  genreView  |
| 将光标放在电影上来请求内容概述 | 用户对该电影感兴趣，表明他对这一类别的电影感兴趣， |   details   |
| 单击电影获取内容               | 用户展现出对该电影更多的兴趣                       | moreDetails |
| 将电影添加到MyList             | 用户想以后再看这部电影                             |  addToList  |
| 开始观看电影                   | 用户“购买”了该电影                                 |  playStart  |

如表1所示，对系统来说，所有这些事件都是证据，因为它们揭示了用户的兴趣所在。在表2中显示了Netflix如何记录证据。

<center>表2、Netflix这样记录证据</center>
| 用户ID | 内容ID | 事件        | 日期                  |
| ------ | ------ | ----------- | --------------------- |
| 1234   | 2      | genreView   | 2017-06-07  20:01:00  |
| 1234   | 41335  | details     | 2017-06-07-  20:02:21 |
| 1234   | 41335  | moreDetails | 2017-06-07-  20:02:30 |
| 1234   | 41335  | addToList   | 2017-06-07-  20:02:55 |
| 1234   | 41335  | playStart   | 2017-06-07-  20:03:01 |

或许还有其他列，如设备类型、位置、速度、天气等，都可以用来更好的理解用户的上下文。

### 2、寻找有用的用户行为

这里需要收集的数据是浏览者在何处停留和研究商品。同样值得跟踪的是浏览者看过哪些内容而这些却没有引起他的兴趣。

要确定浏览网页的访客对什么内容感兴趣，可以测试他在内容页面持续停留的时间。

<center>表3、页面持续时间和可能的解释</center>
| 页面持续时间 | 可能的含义                       |
| ------------ | -------------------------------- |
| 少于5秒      | 不感兴趣                         |
| 超过5秒      | 感兴趣                           |
| 超过1分钟    | 非常感兴趣                       |
| 超过5分钟    | 可能去喝咖啡了                   |
| 超过10分钟   | 未跟踪链接的情况下中断或离开页面 |

可以调整页面的持续时间以适应业务的需要。所有这些都取决于页面的内容。关于搜索功能：检索词是理解用户所需内容的最佳方式之一。即使系统不能提供用户所搜索的内容，记录下该事件依然是有价值的。如果用户正在寻找电影，就可以知道他对该内容感兴趣。有了这些信息，推荐系统可以推荐类似的内容。

**流式商品：**

在流媒体服务中，所有的用户交互都可以被视为隐式评分。下面列出了用户与音乐或电影的互动：

1. 开始播放：用户感兴趣；
2. 停止播放：也许用户由于好奇开始播放，但开始播放后觉得很糟糕，所以停止了。
3. 继续播放：
4. 快进：
5. 播放到最后：很好的信号
6. 重播：积极信号

以上步骤适用于大多数的流媒体商品，但如何从流式商品收集证据取决于所使用的播放器的类型。

### 3、识别用户

只有当有一种方法能唯一识别用户时，收集的用户数据才有用。让用户登录或者使用cookie。

无论如何，只有识别出用户，个性化推荐才能发挥作用。



### 4、收集器

考虑到网站性能和可靠性，最好不要将证据收集任务添加到当前的应用中，而是把它添加到一个并行结构中，该结构能支持你想要实现的功能。

证据收集器有两个逻辑部分：

1. 服务器端：

   当服务器收到一个事件已发生的通知时，它唯一的工作就是保存它。Web API是一个配置成接收此类消息的HTTP地址，并且基本上可以用任何类型的框架实现。

2. 客户端：

   客户端由一个简单的JavaScript函数构成，该函数将证据发布到服务器上的证据收集器。

**数据模型：**

收集大多数类型的交互非常重要，前面的章节指出需要收集的信息有三样：用户ID、内容ID和事件类型。实际上还需要更多的东西才能让证据记录器运行起来。

<center>表4、证据记录器中的数据模型</center>
| Logger                                                       |
| ------------------------------------------------------------ |
| date: datetime;  user_id: varchar(64); content_id: varchar(64); event: varchar(64); session_id: integer |

session_id是每个会话的唯一标识。后续可以向此模型中添加更多的内容，例如设备类型或上下文。

> 关于时间的说明：
>
> 记录时间总是一件麻烦的事，必须考虑到不同的时区。全部使用本地时区意味着你可能会遇到事件顺序问题，因为在不同时区同时发生的事件将相距很远。

### 5、系统中的用户是谁以及如何对其进行建模

除了证据之外，还需要一个用户模型，可以将其转换为数据库表并使用。大多数图书网站可能会使用诸如偏好和购买习惯之类的信息。

在理想情况下，希望在用户标识旁边保留一个键值对列表，如用户ID、邮箱地址和可能其他附加信息。

<img src="D:\Onedrive\Work-Documents\Popoo工作实践\推荐系统解决方案\imgs\Docum_1\Figure_1.PNG" alt="Figure_1" style="zoom: 67%;" />

<center>图1、通用数据模型</center>
可以创建一个包含上述大多数属性的表，以及一个包含以后可能需要的任何额外属性的表。你的用户数据模型可能如图2：

<img src="D:\Onedrive\Work-Documents\Popoo工作实践\推荐系统解决方案\imgs\Docum_1\Figure_2.PNG" alt="Figure_2" style="zoom:67%;" />

<center>图2、用户数据模型</center>
**小节：**

- 使用Web API记录用户行为，这可能在网站之外的Web应用中运行，以确保在用户触发许多事件时不会导致网站性能下降；
- 通过将在网站中发生的所有时间绑定到一个调用，将“告密者(Snitch)”连接到网站；
- 良好的证据向系统提供了有关用户偏好的信息。最好把所有的实践都记录下来，因为在以后它们可能会有用；
- 隐式评分是从用户触发的事件中推断出来的，而显式评分是用户给出的实际评分；
- 隐式评分通常更可靠，但前提是要了解每个事件的含义；
- 显式评分并不总是可靠的，因为它们可能由于社会影响而产生偏差。



